load("data.mat");

J = matrix_J();

Fmag = 20;

t_start = 5;
t_finish = 10;
dt = 1/125;
n = floor(t_start/dt);
N = floor(t_finish/dt);

F_pure = zeros(size(m_torque));
F_pure(n:N,:) = Fmag;

noise = normrnd(0, 0.3, size(F_pure));
F_noisy = F_pure + noise;

tau_f_pure = zeros(size(m_torque));
tau_f_noisy = zeros(size(m_torque));

for i=1:length(m_torque)
     
    Ji = J(q(i,1),q(i,2),q(i,3),q(i,4),q(i,5),q(i,6));
    tau_fi = Ji' * F_pure(i,:)';
    tau_f_pure(i,:) = tau_fi';
    
end

%%

F = [20; 20; 20; 0; 0; 0];

tau_f = zeros(size(m_torque));

t_start = 5;
t_finish = 10;
dt = 1/125;
n = floor(t_start/dt);
N = floor(t_finish/dt);

for i=n:N
     
    Ji = J(q(i,1),q(i,2),q(i,3),q(i,4),q(i,5),q(i,6));
    tau_fi = Ji' * F;
    tau_f(i,:) = tau_fi';
    
end

torque_with_force = m_torque + tau_f;

save('torque_force.mat', 'torque_with_force');

% plot(time, [m_torque(:,1) torque_with_force(:,1)])